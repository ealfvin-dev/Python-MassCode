#:import Factory kivy.factory.Factory

#:set labelColor (0.095, 0.095, 0.096, 0.9)

#:set buttonSpacing dp(33)
#:set buttonHeight dp(60)

<MainLayout>:
    orientation: 'horizontal'
    spacing: self.size[1] / 50
    padding: 0, 0, 0, 0

    BoxLayout:
        orientation: "vertical"
        size_hint: (None, 1)
        width: dp(185)

        AddSeriesButton:
            id: addSeriesButton
            on_press: root.addSeries()

            MarsImage:
                size_hint: (None, None)
                height: dp(18)
                width: dp(18)
                pos: self.getImagePosition(addSeriesButton.pos, addSeriesButton.width, addSeriesButton.texture_size[0], dp(15), dp(4))
                source: self.getImagePath('PlusIcon.png')

        ScrollView:
            id: seriesSelectionSv
            scroll_timeout: 0
            size_hint: (1, 1)
            do_scroll_x: False
            do_scroll_y: True
            bar_width: 0

            SeriesSelectionMenu:
                id: seriesSelectionMenu

                SeriesButton:
                    id: series1
                    seriesNum: 1
                    text: "[color=#000000]Series 1[/color]"
                    background_color: (0.956, 0.958, 0.964, 1)
                    exists: True
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series2
                    seriesNum: 2
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series3
                    seriesNum: 3
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series4
                    seriesNum: 4
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series5
                    seriesNum: 5
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series6
                    seriesNum: 6
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series7
                    seriesNum: 7
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series8
                    seriesNum: 8
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series9
                    seriesNum: 9
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series10
                    seriesNum: 10
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series11
                    seriesNum: 11
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series12
                    seriesNum: 12
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series13
                    seriesNum: 13
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series14
                    seriesNum: 14
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series15
                    seriesNum: 15
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series16
                    seriesNum: 16
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series17
                    seriesNum: 17
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series18
                    seriesNum: 18
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series19
                    seriesNum: 19
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    id: series20
                    seriesNum: 20
                    on_press: root.goToSeries(self.seriesNum, self.exists)

                SeriesButton:
                    seriesNum: -1
                    height: seriesSelectionSv.height - dp(20*55) if seriesSelectionSv.height - dp(20*55) > dp(55) else dp(55)

        SeriesButton:
            id: outputFileTab
            on_press: root.openOutputFile()

        RemoveSeriesButton:
            id: removeSeriesButton
            on_release: root.removeLastSeries()

            MarsImage:
                size_hint: (None, None)
                height: dp(18)
                width: dp(18)
                pos: self.getImagePosition(removeSeriesButton.pos, removeSeriesButton.width, removeSeriesButton.texture_size[0], dp(15), dp(8))
                source: self.getImagePath('MinusIcon.png')

    BoxLayout:
        id: secondaryMainBox
        orientation: 'vertical'
        spacing: dp(2)

        BoxLayout:
            id: navBar
            orientation: 'horizontal'
            size_hint: (1, None)
            height: dp(50)
            padding: (0, 0, 0, 0)

            BoxLayout:
                size_hint: (None, 1)
                width: dp(250)
                orientation: 'horizontal'
                padding: (0, dp(5), dp(20), 0)

                MarsImage:
                    size_hint: (1, 1)
                    source: self.getImagePath('MarsFELogo.png')

            TopMenuButton:
                id: openFileButton
                on_release: app.openFilePop()
                text: "Open File"

                MarsImage:
                    size_hint: (None, None)
                    height: dp(18)
                    width: dp(18)
                    pos: self.getImagePosition(openFileButton.pos, openFileButton.width, openFileButton.texture_size[0])
                    source: self.getImagePath('OpenFileIcon.png')

            TopMenuButton:
                id: newFileButton
                text: "New File"
                on_release: app.openNewFilePop()

                MarsImage:
                    size_hint: (None, None)
                    height: dp(18)
                    width: dp(18)
                    pos: self.getImagePosition(newFileButton.pos, newFileButton.width, newFileButton.texture_size[0])
                    source: self.getImagePath('PlusIcon.png')

            TopMenuButton:
                id: visualizationButton
                text: "Visualization"
                on_release: app.openVisualizationPop()

                MarsImage:
                    size_hint: (None, None)
                    height: dp(18)
                    width: dp(18)
                    pos: self.getImagePosition(visualizationButton.pos, visualizationButton.width, visualizationButton.texture_size[0])
                    source: self.getImagePath('VisualizationIcon.png')

            TopMenuButton:
                id: runTestsButton
                text: "Run Tests"
                on_release: app.openValidationPop()

                MarsImage:
                    size_hint: (None, None)
                    height: dp(18)
                    width: dp(18)
                    pos: self.getImagePosition(runTestsButton.pos, runTestsButton.width, runTestsButton.texture_size[0])
                    source: self.getImagePath('RunTestsIcon.png')

            TopMenuButton:
                id: settingsButton
                text: "Settings"
                on_release: app.openSettingPop()

                MarsImage:
                    size_hint: (None, None)
                    height: dp(18)
                    width: dp(18)
                    pos: self.getImagePosition(settingsButton.pos, settingsButton.width, settingsButton.texture_size[0])
                    source: self.getImagePath('SettingsIcon.png')

        BoxLayout:
            id: content
            size_hint: (1, 1)
            orientation: 'horizontal'
            spacing: dp(35)
            padding: (dp(10), dp(5), dp(15), dp(15))

            BoxLayout:
                id: menu
                size_hint: (None, 1)
                width: dp(510)
                orientation: 'vertical'
                spacing: dp(15)
                padding: (0, dp(5), 0, 0)

                ScrollView:
                    id: menuSv
                    size_hint_max_y: inputButtonGrid.height
                    scroll_timeout: 0
                    do_scroll_x: False
                    do_scroll_y: True
                    bar_width: 0

                    GridLayout:
                        id: inputButtonGrid
                        size_hint: (1, None)
                        height: self.minimum_height
                        cols: 1
                        spacing: dp(11)

                        Label:
                            size_hint: (1, None)
                            text_size: (menu.width, None)
                            height: dp(20)
                            text: "[b]\nSeries 1 Header[/b]"
                            markup: True
                            color: labelColor
                            font_size: dp(14)
                            halign: 'left'

                        BoxLayout:
                            id: menuRow1
                            size_hint: (1, None)
                            height: buttonHeight
                            orientation: 'horizontal'
                            spacing: buttonSpacing

                            InputButton:
                                id: labInfoButton
                                text: "Report No. &\nNotes"
                                on_release: app.openLabInfoPop()

                            InputButton:
                                id: restraintButton
                                text: "Restraint"
                                on_release: app.openRestraintPop()

                        BoxLayout:
                            id: headerSeparater-blank
                            size_hint: (1, None)
                            height: dp(5)
                            orientation: 'horizontal'
                            size_hint: (1, None)

                            Label:
                                text: ""
                                font_size: dp(12)

                        Label:
                            size_hint: (1, None)
                            text_size: (menu.width, None)
                            height: dp(20)
                            text: "[b]\nSeries Setup[/b]"
                            markup: True
                            color: labelColor
                            font_size: dp(14)
                            halign: 'left'

                        BoxLayout:
                            id: menuRow2
                            size_hint: (1, None)
                            height: buttonHeight
                            orientation: 'horizontal'
                            spacing: buttonSpacing

                            InputButton:
                                id: dateButton
                                text: "Balance &\nDate"
                                on_release: app.openDatePop()

                            InputButton:
                                id: weightsButton
                                text: "Weights"
                                on_release: app.openWeightsPop()

                            InputButton:
                                id: gravityButton
                                text: "Gravity\n(Optional)"
                                buttonColor: root.getGravityButtonColor()
                                on_release: app.openGravityPop()

                        Label:
                            size_hint: (1, None)
                            text_size: (menu.width, None)
                            height: dp(20)
                            text: "[b]\nDesign[/b]"
                            markup: True
                            color: labelColor
                            font_size: dp(14)
                            halign: 'left'

                        BoxLayout:
                            id: menuRow3
                            size_hint: (1, None)
                            height: buttonHeight
                            orientation: 'horizontal'
                            spacing: buttonSpacing

                            InputButton:
                                id: designButton
                                text: "Design"
                                on_release: app.openDesignPop()

                            InputButton:
                                id: positionVectorsButton
                                text: "Position\nVectors"
                                on_release: app.openVectorsPop()

                        Label:
                            size_hint: (1, None)
                            text_size: (menu.width, None)
                            height: dp(20)
                            text: "[b]\nStatistics[/b]"
                            markup: True
                            color: labelColor
                            font_size: dp(14)
                            halign: 'left'

                        BoxLayout:
                            id: menuRow4
                            size_hint: (1, None)
                            height: buttonHeight
                            orientation: 'horizontal'
                            spacing: buttonSpacing

                            InputButton:
                                id: statisticsButton
                                text: "Statistics"
                                on_release: app.openStatisticsPop()

                        Label:
                            size_hint: (1, None)
                            text_size: (menu.width, None)
                            height: dp(20)
                            text: "[b]\nMeasurement Data[/b]"
                            markup: True
                            color: labelColor
                            font_size: dp(14)
                            halign: 'left'

                        BoxLayout:
                            id: menuRow5
                            size_hint: (1, None)
                            height: buttonHeight
                            orientation: 'horizontal'
                            spacing: buttonSpacing

                            InputButton:
                                id: swButton
                                text: "Sensitivity\nWeight"
                                on_release: app.openSwPop()

                            InputButton:
                                id: measurementsButton
                                text: "Data"
                                on_release: app.openMeasurementsPop()

                        BoxLayout:
                            id: menuRow6-blank
                            size_hint: (1, None)
                            height: dp(8)
                            orientation: 'horizontal'
                            size_hint: (1, None)

                            Label:
                                text: ""
                                font_size: dp(12)

                        BoxLayout:
                            id: menuCol7
                            size_hint: (1, None)
                            height: dp(56)
                            orientation: 'horizontal'
                            spacing: dp(30)

                            BottomButton:
                                id: debugButton
                                text: "[b]     Debug[/b]"
                                on_release: root.debug()

                                MarsImage:
                                    size_hint: (None, None)
                                    height: dp(15)
                                    width: dp(15)
                                    pos: self.getImagePosition(debugButton.pos, debugButton.width, debugButton.texture_size[0], dp(23), dp(1))
                                    source: self.getImagePath('BugIcon.png')

                            BottomButton:
                                id: splitButton
                                text: "[b]     Split[/b]"
                                on_release: root.reSplit()

                                MarsImage:
                                    size_hint: (None, None)
                                    height: dp(15)
                                    width: dp(15)
                                    pos: self.getImagePosition(splitButton.pos, splitButton.width, splitButton.texture_size[0], dp(23), dp(1))
                                    source: self.getImagePath('SplitIcon.png')

                            BottomButton:
                                id: saveButton
                                text: "[b]     SAVE[/b]"
                                on_release: root.save()

                                MarsImage:
                                    size_hint: (None, None)
                                    height: dp(15)
                                    width: dp(15)
                                    pos: self.getImagePosition(saveButton.pos, saveButton.width, saveButton.texture_size[0], dp(23), dp(1))
                                    source: self.getImagePath('SaveIcon.png')

                            RunButton:
                                id: runButton
                                text: "[b]     RUN[/b]"
                                on_release: root.runReduction()

                                MarsImage:
                                    size_hint: (None, None)
                                    height: dp(15)
                                    width: dp(15)
                                    pos: self.getImagePosition(runButton.pos, runButton.width, runButton.texture_size[0], dp(23), dp(1))
                                    source: self.getImagePath('MarsIcon.png')

                BoxLayout:
                    id: menuRow6-blank
                    size_hint: (1, None)
                    height: dp(1)
                    orientation: 'horizontal'
                    size_hint: (1, None)

                    Label:
                        text: ""
                        font_size: dp(12)

                Label:
                    size_hint: (1, None)
                    height: dp(9)
                    text: "Additional Notes:"
                    color: labelColor
                    text_size: notesText.width, None
                    font_size: dp(13)
                    halign: 'left'

                UserInput:
                    id: notesText
                    size_hint: (1, 0.1)
                    size_hint_min_y: dp(70)
                    padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
                    background_normal: ''
                    background_color: (1, 1, 1, 1)
                    font_name: "Menlo.ttc"
                    foreground_color: 0, 0, 0, 1
                    markup: True
                    selection_color: (0.1843, 0.6549, 0.8313, 0.27)
                    on_text: root.noteTextAdded()

            BoxLayout:
                id: textAreas
                orientation: "vertical"
                spacing: dp(6)
                padding: (0, 0, 0, 0)
                size_hint: (1, 1)

                Label:
                    id: configFileName
                    size_hint: (1, None)
                    height: dp(9)
                    font_size: dp(13)
                    text: ""
                    color: labelColor
                    text_size: userText.width, None
                    halign: 'left'

                UserInput:
                    id: userText
                    size_hint: (1, 0.87)
                    padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
                    background_normal: ''
                    background_color: (1, 1, 1, 1)
                    font_name: "Menlo.ttc"
                    text: "@SERIES\n\n"
                    foreground_color: 0, 0, 0, 1
                    markup: True
                    on_focus: self.setSelectionColor()
                    on_text: root.textAdded(self.cursor_row)

                MainErrorText:
                    id: errors
                    size_hint: (1, 0.13)
                    padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
                    background_normal: ''
                    background_active: ''
                    font_name: "Menlo.ttc"
                    readonly: True

        Label:
            font_size: dp(10)
            text: "[color=#000000]MARS 1.0 Copyright Erik Alfvin, 2021[/color]\n"
            markup: True
            text_size: root.width, None
            size: self.texture_size
            halign: 'center'
            size_hint: (0.88, 0.01)

<LabInfoPopup>:
    auto_dismiss: False
    title: "Report Number and Notes"
    size: (dp(600), dp(475))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Laboratory Information & Notes:"
            size_hint: (1, None)

        OrderedText:
            id: labInfoText
            size_hint: (1, None)
            hint_text: "Calibration Laboratory\nAddress Line 1\nAddress Line 2\nAddress Line 3\nItem Description\nNotes"
            padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
            write_tab: True
            multiline: True
            height: dp(200)
            orderNum: 0

        PopupLabel:
            text: "Report Number:"
            size_hint: (1, None)

        OrderedText:
            id: reportNumText
            size_hint: (0.5, None)
            hint_text: "999999a"
            orderNum: 1

        PopupErrorLabel:
            id: labInfoPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<RestraintPopup>:
    auto_dismiss: False
    title: "Series 1 Restraint"
    size: (dp(400), dp(310))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Restraint ID:"
            size_hint: (1, None)

        OrderedText:
            id: restraintIDText
            size_hint: (1, None)
            hint_text: "049"
            orderNum: 2

        PopupLabel:
            text: "Restraint Uncertainty (mg):"
            size_hint: (1, None)

        OrderedText:
            id: restraintUncertaintyText
            size_hint: (1, None)
            hint_text: "0.062"
            orderNum: 3

        PopupErrorLabel:
            id: restraintPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<DatePopup>:
    auto_dismiss: False
    title: "Date and Balance"
    size: (dp(570), dp(410))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            spacing: dp(20)
            height: dp(230)

            BoxLayout:
                orientation: "vertical"
                size_hint: (0.5, None)
                spacing: dp(8)
                padding: dp(10), dp(10), dp(10), dp(10)

                PopupLabel:
                    text: "Date:"
                    size_hint: (1, None)

                OrderedText:
                    id: dateText
                    size_hint: (1, None)
                    hint_text: "MM DD YYYY"
                    orderNum: 6

                PopupLabel:
                    text: "Technician ID:"
                    size_hint: (1, None)

                OrderedText:
                    id: techIDText
                    size_hint: (1, None)
                    hint_text: "019"
                    orderNum: 7

                PopupErrorLabel:
                    size_hint: (1, None)
                    height: SFLabel.height

                PopupErrorLabel:
                    size_hint: (1, None)
                    height: techIDText.height

            BoxLayout:
                orientation: "vertical"
                size_hint: (0.5, None)
                spacing: dp(8)
                padding: dp(10), dp(10), dp(10), dp(10)

                PopupLabel:
                    text: "Balance ID:"
                    size_hint: (1, None)

                OrderedText:
                    id: balanceIDText
                    size_hint: (1, None)
                    hint_text: "14"
                    orderNum: 8

                PopupLabel:
                    text: "Direct Readings (1 = Yes, 0 = No):"
                    size_hint: (1, None)

                OrderedText:
                    id: directReadingsText
                    size_hint: (1, None)
                    text: "0"
                    hint_text: "0"
                    orderNum: 9

                PopupLabel:
                    id: SFLabel
                    text: "Direct Reading Sensitivity Factor\n(mg/div):"
                    size_hint: (1, None)

                OrderedText:
                    id: directReadingsSFText
                    size_hint: (1, None)
                    text: "1.0"
                    hint_text: "1.0"
                    orderNum: 10

        PopupErrorLabel:
            id: datePopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<DesignPopup>:
    auto_dismiss: False
    title: "Design"
    size: (dp(570), dp(550))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Design Matrix:"
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            spacing: dp(20)
            height: dp(280)

            OrderedText:
                id: designText
                size_hint: (0.7, None)
                height: dp(280)
                hint_text: "1 -1  0  0\n1  0 -1  0\n1  0  0 -1\n0  1 -1  0\n0  1  0 -1\n0  0  1 -1"
                padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
                write_tab: True
                multiline: True
                on_text: root.evalDesign()
                orderNum: 18

            BoxLayout:
                orientation: "vertical"
                spacing: dp(25)
                padding: (0, 0, 0, dp(143))
                size_hint: (0.3, None)
                height: dp(280)

                ExtraButton:
                    id: dropDownMain
                    text: "Presets"
                    size_hint: (None, None)
                    size: (dp(140), dp(50))
                    on_release: dropDownn.open(self)

                DropDown:
                    id: dropDownn

                    Button:
                        text: "3-1"
                        size_hint_y: None
                        height: dp(30)
                        on_press: root.writeDesign(self.text)

                    Button:
                        text: "4-1"
                        size_hint_y: None
                        height: dp(30)
                        on_press: root.writeDesign(self.text)

                    Button:
                        text: "2 x 4-1"
                        size_hint_y: None
                        height: dp(30)
                        on_press: root.writeDesign(self.text)

                    Button:
                        text: "5-1"
                        size_hint_y: None
                        height: dp(30)
                        on_press: root.writeDesign(self.text)

                    Button:
                        text: "532111"
                        size_hint_y: None
                        height: dp(30)
                        on_press: root.writeDesign(self.text)

                    Button:
                        text: "522111"
                        size_hint_y: None
                        height: dp(30)
                        on_press: root.writeDesign(self.text)

                PopupLabel:
                    id: positionsLabel
                    text: "Positions:"
                    size_hint: (1, None)

                PopupLabel:
                    id: observationsLabel
                    text: "Observations:"
                    size_hint: (1, None)

        PopupLabel:
            text: "Design ID:"
            size_hint: (1, None)

        OrderedText:
            id: designIDText
            size_hint: (0.4, None)
            hint_text: "112"
            orderNum: 17

        PopupErrorLabel:
            id: designPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<WeightsPopup>:
    auto_dismiss: False
    title: "Weights"
    size: (dp(600), dp(495))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Weight Data:\nID  |  Nominal (g, lb)  |  Density (g/cm3)  |  CCE (/" + chr(730) + "C)  |  Correction (mg):"
            size_hint: (1, None)

        OrderedText:
            id: weightsText
            size_hint: (1, None)
            hint_text: "P1.kg     1000  7.9826  0.000045  2.345\nP1..kg    1000  7.9834  0.000045  1.824\nT1.kg     1000  8.0451  0.000045 \nT1..kg    1000  8.0405  0.000045"
            padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
            write_tab: True
            multiline: True
            height: dp(200)
            orderNum: 16

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            spacing: dp(20)
            height: dp(20)

            PopupLabel:
                text: "Nominal Units (1 = g, 0 = lb):"
                size_hint: (0.5, None)

            PopupLabel:
                text: "Check Standard ID:"
                size_hint: (0.5, None)

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            spacing: dp(20)
            height: dp(42)

            OrderedText:
                id: nominalsText
                size_hint: (0.5, None)
                hint_text: "1"
                text: "1"
                orderNum: 15

            OrderedText:
                id: checkIDText
                size_hint: (0.5, None)
                hint_text: "54"
                orderNum: 14

        PopupErrorLabel:
            id: weightsPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<VectorsPopup>:
    auto_dismiss: False
    title: "Position Vectors"
    size: (dp(400), dp(380))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)
            
        PopupLabel:
            text: "Restraint Position:"
            size_hint: (1, None)

        OrderedText:
            id: restraintVectorText
            size_hint: (1, None)
            hint_text: "1 1 0 0"
            orderNum: 19

        PopupLabel:
            text: "Check Standard Position:"
            size_hint: (1, None)

        OrderedText:
            id: checkVectorText
            size_hint: (1, None)
            hint_text: "1 -1 0 0"
            orderNum: 20

        PopupLabel:
            text: "Next Series Restraint:"
            size_hint: (1, None)

        OrderedText:
            id: nextRestraintText
            size_hint: (1, None)
            hint_text: "0 0 0 0"
            orderNum: 21

        PopupErrorLabel:
            id: vectorsPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<StatisticsPopup>:
    auto_dismiss: False
    title: "Statistics"
    size: (dp(400), dp(495))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Use standard deviations saved in the database:"
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: 0
            padding: (0, 0, 0, 0)
            size_hint: (1, None)
            height: dp(50)

            Label:
                text: ""
                size_hint: (0.39, None)

            ExtraButton:
                id: useStatsButton
                text: "Database"
                size_hint: (0.22, None)
                height: self.texture_size[1]*2 - dp(2)
                on_release: root.getStats()

            Label:
                text: ""
                size_hint: (0.39, None)

        PopupLabel:
            text: "\n-------- Or use new standard deviations --------\n"
            size_hint: (1, None)
            halign: "center"

        PopupLabel:
            text: chr(963) + "[size=8dp]w[/size] (mg):"
            size_hint: (1, None)

        OrderedText:
            id: sigmawText
            size_hint: (1, None)
            hint_text: "0.012"
            on_text: root.evalSaveButtons(saveStatsButton.disabled)
            orderNum: 22

        PopupLabel:
            text: chr(963) + "[size=8dp]t[/size] (mg):"
            size_hint: (1, None)

        OrderedText:
            id: sigmatText
            size_hint: (1, None)
            hint_text: "0.008"
            on_text: root.evalSaveButtons(saveStatsButton.disabled)
            orderNum: 23

        ExtraButton:
            id: saveStatsButton
            text: "Add to Database"
            disabled: True
            size_hint: (0.36, None)
            height: self.texture_size[1]*2 - dp(2)
            on_release: root.saveStats(sigmawText.text, sigmatText.text)

        PopupErrorLabel:
            id: sigmaPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<SaveStatisticsPopup>:
    auto_dismiss: False
    title: "Add Standard Deviations to Database"
    size: (dp(440), dp(380))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Nominal: (Available units = g, mg, kg, lb)"
            size_hint: (1, None)

        OrderedText:
            id: nominalText
            size_hint: (1, None)
            hint_text: "100 mg"

        PopupLabel:
            text: "Description:"
            size_hint: (1, None)

        OrderedText:
            id: descriptionText
            size_hint: (1, None)
            hint_text: "AT1006 4-1"

        PopupErrorLabel:
            size_hint: (1, None)
            height: dp(10)

        PopupLabel:
            text: chr(963) + "[size=8dp]w[/size]: " + root.sigw + " mg"
            size_hint: (1, None)

        PopupLabel:
            text: chr(963) + "[size=8dp]t[/size]: " + root.sigt + " mg"
            size_hint: (1, None)

        PopupErrorLabel:
            id: statsError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                text: "Back"
                on_release: root.dismiss()

            WriteButton:
                text: "Add"
                on_release: root.saveStats()

<SwPopup>:
    auto_dismiss: False
    title: "Sensitivity Weight"
    size: (dp(400), dp(570))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Use a sensitivity weight saved in the database:"
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: 0
            padding: (0, 0, 0, 0)
            size_hint: (1, None)
            height: dp(50)

            Label:
                text: ""
                size_hint: (0.39, None)

            ExtraButton:
                id: useSwButton
                text: "Database"
                size_hint: (0.22, None)
                height: self.texture_size[1]*2 - dp(2)
                on_release: root.getSw()

            Label:
                text: ""
                size_hint: (0.39, None)

        PopupLabel:
            text: "\n-------- Or use a new sensitivity weight --------\n"
            size_hint: (1, None)
            halign: "center"

        PopupLabel:
            text: "sw True Mass (mg):"
            size_hint: (1, None)

        OrderedText:
            id: swMassText
            size_hint: (1, None)
            hint_text: "50.1023"
            on_text: root.evalSaveButtons(saveSwButton.disabled)
            orderNum: 24

        PopupLabel:
            text: "sw Density (g/cm3):"
            size_hint: (1, None)

        OrderedText:
            id: swDensityText
            size_hint: (1, None)
            hint_text: "7.95"
            on_text: root.evalSaveButtons(saveSwButton.disabled)
            orderNum: 25

        PopupLabel:
            text: "sw CCE (/" + chr(730) + "C):"
            size_hint: (1, None)

        OrderedText:
            id: swCCEText
            size_hint: (1, None)
            hint_text: "0.000045"
            on_text: root.evalSaveButtons(saveSwButton.disabled)
            orderNum: 26

        ExtraButton:
            id: saveSwButton
            text: "Add to Database"
            disabled: True
            size_hint: (0.36, None)
            height: self.texture_size[1]*2 - dp(2)
            on_release: root.saveSw(swMassText.text, swDensityText.text, swCCEText.text)

        PopupErrorLabel:
            id: swPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<SaveSwPopup>:
    auto_dismiss: False
    title: "Add Sensitivity Weight to Database"
    size: (dp(440), dp(335))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Sensitivity Weight Name:"
            size_hint: (1, None)

        OrderedText:
            id: swNameText
            size_hint: (1, None)
            hint_text: "sw5g"

        PopupErrorLabel:
            size_hint: (1, None)
            height: dp(10)

        PopupLabel:
            text: "Mass: " + root.swMass + " mg"
            size_hint: (1, None)

        PopupLabel:
            text: "Density: " + root.swDensity + " g/cm3"
            size_hint: (1, None)

        PopupLabel:
            text: "CCE: " + root.swCCE + " /" + chr(730) + "C"
            size_hint: (1, None)

        PopupErrorLabel:
            id: swNameError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                text: "Back"
                on_release: root.dismiss()

            WriteButton:
                id: addButton
                text: "Add"

<MeasurementsPopup>:
    auto_dismiss: False
    title: "Measurements"
    size: (dp(750), dp(580))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            spacing: dp(12)
            height: dp(20)

            PopupLabel:
                text: "\nBalance Readings:"
                size_hint: (0.65, None)

            BoxLayout:
                orientation: "horizontal"
                size_hint: (0.35, None)
                spacing: dp(12)
                height: dp(20)

                PopupLabel:
                    text: "Environmentals\n(" + chr(730) + "C, mmHg, %):"
                    size_hint: (0.60, None)

                ExtraButton:
                    text: "Auto-Fill"
                    size_hint: (0.40, None)
                    height: self.texture_size[1]*2 - dp(2)
                    on_release: root.autoFill()

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            spacing: dp(12)
            height: dp(260)
            
            OrderedText:
                id: balanceReadingsText
                size_hint: (0.65, 1)
                hint_text: "0     -0.61 19.42 20.02\n0.00  -0.59 19.42 20.03\n0.01  -0.51 19.51 20.02\n-0.60 -0.61 19.42 19.42"
                padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
                write_tab: True
                multiline: True
                orderNum: 29
            
            OrderedText:
                id: envText
                size_hint: (0.35, 1)
                hint_text: "20.9 749.24 46.74\n20.8 749.26 46.81\n20.8 749.29 46.99\n20.9 749.31 47.11"
                padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
                write_tab: True
                multiline: True
                orderNum: 27

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            spacing: dp(12)
            height: dp(40)

            Label:
                size_hint: (0.65, None)
                text: ""
                height: self.texture_size[1]

            PopupLabel:
                text: "Environmental Corrections\n(" + chr(730) + "C, mmHg, %):"
                size_hint: (0.35, None)

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            spacing: dp(12)
            height: dp(42)

            Label:
                size_hint: (0.65, None)
                text: ""
                height: self.texture_size[1]

            OrderedText:
                id: envCorrectionsText
                size_hint: (0.35, None)
                hint_text: "0.05 0.105 -0.07"
                orderNum: 28

        PopupErrorLabel:
            id: measurementsPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<GravityPopup>:
    auto_dismiss: False
    title: "Local Gravity Corrections"
    size: (dp(400), dp(560))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Weight Heights (cm):"
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, None)
            height: dp(200)
        
            OrderedText:
                id: heightText
                size_hint: (0.6, 1)
                hint_text: "10.3\n10.5\n14.0\n9.7"
                multiline: True
                padding: [dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height, dp(5), dp(5) + 0.5 * (self.height - 2*dp(5)) % self.line_height]
                orderNum: 13

            Label:
                id: gravityWeightIds
                size_hint: (0.4, None)
                height: heightText.height
                text_size: (self.width, self.height)
                color: labelColor
                font_size: root.getUserFontSize()
                padding: (dp(5), dp(5) + 0.5 * (heightText.height - 2*dp(5)) % heightText.line_height)
                halign: "left"
                valign: "top"

        PopupLabel:
            text: "Gravity Gradient (1/s" + chr(178) + "):"
            size_hint: (1, None)

        OrderedText:
            id: gradientText
            size_hint: (0.5, None)
            hint_text: "0.0000031"
            orderNum: 11

        PopupLabel:
            text: "Local Acceleration of\nGravity (m/s" + chr(178) + "):"
            size_hint: (1, None)

        OrderedText:
            id: localGravityText
            size_hint: (0.5, None)
            hint_text: "9.8"
            orderNum: 12

        PopupErrorLabel:
            id: gravityPopError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                on_release: root.dismiss()

            WriteButton:
                on_release: root.submit()

<OpenFilePopup>:
    auto_dismiss: False
    title: "Open File"
    title_size: dp(18)
    size_hint: (None, None)
    size: (dp(750), dp(580))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Select Configuration File:"
            size_hint: (1, None)
            color: root.title_color

        FileChooserListView:
            #Edited /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/kivy/data/style.kv
            #Line 339 -> height: '24dp' before it was dependent on screen resolution
            id: filechooser
            dirselect: False
            path: root.getDefaultPath()
            filters: ["*-config.txt"]

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(60)

            WriteButton:
                text: "Open"
                size: (dp(150), dp(55))
                on_release: root.openFile(filechooser.selection)

            CancelButton:
                size: (dp(150), dp(55))
                on_release: root.dismiss()

<OpenNewFilePopup>:
    auto_dismiss: True
    title: "Open New File"
    title_size: dp(18)
    size_hint: (None, None)
    size: (dp(520), dp(250))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(50)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupErrorLabel:
            id: newFileMessage
            size_hint: (1, None)
            color: root.title_color
            halign: "center"
            height: dp(20)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(60)

            WriteButton:
                id: openNewFileButton
                text: ""
                size: (dp(150), dp(55))

            CancelButton:
                id: cancelNewFileButton
                size: (dp(150), dp(55))
                on_release: root.dismiss()

<NewFileSaveLocPopup>:
    auto_dismiss: False
    title: "File Save Location"
    title_size: dp(18)
    size_hint: (None, None)
    size: (dp(750), dp(580))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Where do you want to save this file?"
            size_hint: (1, None)
            color: root.title_color

        FileChooserListView:
            #Edited /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/kivy/data/style.kv
            #Line 339 -> height: '24dp' before it was dependent on screen resolution
            id: filechooserSaveLoc
            path: root.getDefaultPath()
            filters: ["*-config.txt"]
            dirselect: False

        BoxLayout:
            orientation: "horizontal"
            spacing: dp(5)
            size_hint: (1, None)
            height: dp(40)

            OrderedText:
                id: saveFileName
                size_hint: (None, None)
                width: dp(250)
                padding: [dp(5), dp(17) - int(self.font_size/2), dp(5), dp(5)]
                halign: 'right'
            
            Label:
                size_hint: (None, 1)
                text: "-config.txt"
                width: self.texture_size[0]

        PopupErrorLabel:
            id: saveFileMessage
            size_hint: (1, None)
            height: dp(20)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(60)

            WriteButton:
                text: "Save"
                size: (dp(150), dp(55))
                on_release: root.setSaveLoc(filechooserSaveLoc.path, saveFileName.text)

            CancelButton:
                id: cancelNewFileButton
                size: (dp(150), dp(55))
                on_release: root.dismiss()

<ValidationPopup>:
    auto_dismiss: False
    title: "Internal Testing"
    title_size: dp(18)
    size_hint: (None, None)
    size: (dp(750), dp(560))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Results:"
            color: root.title_color
            size_hint: (1, None)

        OrderedText:
            id: validationText
            size_hint: (1, None)
            height: dp(350)
            multiline: True
            readonly: True
            text_size: dp(11)
            padding: [dp(5), dp(5), dp(5), dp(5)]
            orderNum: 999

        PopupErrorLabel:
            id: testingMessage
            color: (0.05, 0.95, 0.09, 1)
            size_hint: (1, None)
            height: dp(20)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(60)

            WriteButton:
                id: testingCloseButton
                text: "Close"
                size: (dp(150), dp(55))
                on_release: root.dismiss()

            PopupErrorLabel:
                size_hint: (1, None)
                height: testingCloseButton.height

<SettingsPopup>:
    auto_dismiss: False
    title: "MARS Settings"
    size: (dp(440), dp(360))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Font Size:"
            size_hint: (1, None)

        OrderedText:
            id: fontSize
            size_hint: (1, None)
            text: root.getFontSize()

        PopupLabel:
            text: "Default File Path:"
            size_hint: (1, None)

        BoxLayout:
            size_hint: (1, None)
            height: filePath.height
            orientation: "horizontal"
            spacing: dp(8)

            OrderedText:
                id: filePath
                size_hint: (0.8, None)
                text: root.getDefaultPath()

            ExtraButton:
                size_hint: (0.2, None)
                height: 3 * dp(13)
                text: "Choose"
                on_release: root.chooseDefaultPath()

        BoxLayout:
            size_hint: (1, None)
            height: dp(20)
            orientation: "horizontal"
            spacing: dp(8)
            padding: dp(1), 0, dp(1), 0

            PopupLabel:
                size_hint: (1, None)
                text: "Run internal tests on startup"

            StartupTestsCheckBox:
                id: notesCheckBox
                size_hint: (None, None)
                size: (dp(10), dp(10))
                color: (0.105, 0.165, 0.23, 1)
                active: self.getStartupTestsValue()

        BoxLayout:
            size_hint: (1, None)
            height: dp(20)
            orientation: "horizontal"
            spacing: dp(8)
            padding: dp(1), 0, dp(1), 0

            PopupLabel:
                size_hint: (1, None)
                text: "Write notes to {filename}-notes.txt"

            NotesCheckBox:
                id: notesCheckBox
                size_hint: (None, None)
                size: (dp(10), dp(10))
                color: (0.105, 0.165, 0.23, 1)
                active: self.getNotesValue()

        PopupErrorLabel:
            id: settingsError
            size_hint: (1, None)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(50)

            CancelButton:
                text: "Back"
                on_release: root.dismiss()

            WriteButton:
                text: "Save"
                on_release: root.saveSettings()

<DefaultPathPopup>:
    auto_dismiss: False
    title: "Default File Path"
    title_size: dp(18)
    size_hint: (None, None)
    size: (dp(750), dp(580))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(8)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Select a Default File Path:"
            size_hint: (1, None)
            color: root.title_color

        FileChooserListView:
            #Edited /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/kivy/data/style.kv
            #Line 339 -> height: '24dp' before it was dependent on screen resolution
            id: settingsFilechooser
            dirselect: False
            path: root.getDefaultPath()

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(60)

            WriteButton:
                text: "Select"
                size: (dp(150), dp(55))
                on_release: root.setDefaultPath(settingsFilechooser.path)

            CancelButton:
                size: (dp(150), dp(55))
                on_release: root.dismiss()

<StartupTestsPopup>:
    auto_dismiss: False
    title: "Startup Tests"
    title_size: dp(18)
    size_hint: (None, None)
    size: (dp(520), dp(250))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(50)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            id: testStatus
            text: "[b]Running startup tests...[/b]"
            size_hint: (1, None)
            color: (0.05, 0.95, 0.09, 0.9)

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(60)

            WriteButton:
                id: openLogButton
                text: "Open Log"
                size: (dp(150), dp(55))
                background_color: (0.62, 0.62, 0.62, 0.62)

            PopupErrorLabel:
                size_hint: (1, None)
                height: openLogButton.height

<RequestClosePopup>:
    auto_dismiss: True
    title: "Close MARS"
    title_size: dp(18)
    size_hint: (None, None)
    size: (dp(520), dp(250))

    BoxLayout:
        orientation: "vertical"
        spacing: dp(50)
        padding: dp(10), dp(10), dp(10), dp(10)

        PopupLabel:
            text: "Close without saving input file?"
            size_hint: (1, None)
            color: root.title_color
            halign: "center"

        BoxLayout:
            orientation: "horizontal"
            spacing: self.width - 2*dp(150)
            size_hint: (1, None)
            height: dp(60)

            WriteButton:
                text: "Cancel"
                size: (dp(150), dp(55))
                on_release: root.dismiss()

            CancelButton:
                text: "Exit"
                size: (dp(150), dp(55))
                on_release: app.closeApp()